<%= form_with(model: [:admin, work], class: "space-y-8") do |f| %>
  <% if work.errors.any? %>
    <div class="bg-red-50 border-l-4 border-red-500 p-4">
      <h3 class="text-red-800 font-medium"><%= pluralize(work.errors.count, "error") %> prohibited this work from being saved:</h3>
      <ul class="list-disc pl-5 mt-2 text-red-700">
        <% work.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="space-y-4">
      <div>
        <%= f.label :title, "作品タイトル (必須)", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :title, class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
      </div>



      <div>
        <%= f.label :client_name, "クライアント名", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :client_name, class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
      </div>

        <div class="grid grid-cols-1 gap-4">
        <div>
          <%= f.label :year, "制作年 (YYYY)", class: "block text-sm font-medium text-gray-700" %>
          <%= f.select :year, (2000..Time.current.year).to_a.reverse, { selected: f.object.year || Time.current.year }, { class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" } %>
        </div>
      </div>
    </div>

    <div class="space-y-4">
      <div>
        <%= f.label :main_image, "メイン画像 (必須)", class: "block text-sm font-medium text-gray-700" %>
        <% if work.main_image.attached? && work.persisted? %>
          <div class="mb-2">
            <%= image_tag work.main_image.variant(resize_to_limit: [300, 200]), class: "rounded border mb-2" %>
          </div>
        <% end %>
        <%= f.file_field :main_image, class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-black hover:file:bg-gray-200" %>
      </div>

      <div>
        <%= f.label :gallery_images, "ギャラリー画像", class: "block text-sm font-medium text-gray-700" %>
        <% if work.gallery_images.attached? && work.persisted? %>
          <div class="flex flex-wrap gap-2 mb-2">
            <% work.gallery_images.each do |img| %>
              <%= image_tag img.variant(resize_to_limit: [100, 100]), class: "rounded border w-24 h-24 object-cover" %>
            <% end %>
          </div>
        <% end %>
        <%= f.file_field :gallery_images, multiple: true, class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-black hover:file:bg-gray-200" %>
      </div>
    </div>
  </div>

  <div class="space-y-4">
    <div>
      <%= f.label :description, "作品説明", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_area :description, rows: 6, class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">


      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">事業ハッシュタグ (個別ページ表示用)</label>
        <div class="space-y-2 max-h-48 overflow-y-auto border !border-black !border-2 rounded-md p-3" style="border-color: #000 !important; border-width: 2px !important;">
          <% Work::VALID_SERVICE_TAGS.each do |tag| %>
            <div class="flex items-center">
              <%= f.check_box :service_tags, { multiple: true, class: "h-4 w-4 text-black focus:ring-black border-gray-300 rounded" }, tag, nil %>
              <label class="ml-2 block text-sm text-gray-900">
                <% service_names = {
                  'education' => '教えます (Education)',
                  'development' => '作ります (Development)',
                  'maintenance' => '守ります (Maintenance)',
                  'improvement' => '改善します (Improvement)',
                  'consulting' => '相談乗ります (Consulting)'
                } %>
                <%= service_names[tag] %>
              </label>
            </div>
          <% end %>
        </div>
        <p class="text-xs text-gray-500 mt-1">チェックを入れた事業の個別ページに表示されます。</p>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">使用技術</label>
      
      <!-- Existing Technologies Checkboxes -->
      <div class="mb-4 space-y-2 max-h-48 overflow-y-auto border !border-black !border-2 rounded-md p-3 bg-white" style="border-color: #000 !important; border-width: 2px !important;">
        <% ((@existing_technologies || []) + (@work.technologies || [])).uniq.sort.each do |tech| %>
          <div class="flex items-center">
            <%= f.check_box :technologies, { multiple: true, checked: @work.technologies&.include?(tech), class: "h-4 w-4 text-black focus:ring-black border-gray-300 rounded" }, tech, nil %>
            <label class="ml-2 block text-sm text-gray-900"><%= tech %></label>
          </div>
        <% end %>
        <% if @existing_technologies.blank? && @work.technologies.blank? %>
          <p class="text-sm text-gray-400 italic">登録済みの技術はありません</p>
        <% end %>
      </div>

      <!-- New Technology Input -->
      <div>
        <%= f.label :new_technologies, "新規追加 (カンマ区切り)", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :new_technologies, value: "", placeholder: "例: React, TypeScript (これらは自動的にチェックボックスに追加されます)", class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
      </div>
    </div>

    <div>
      <%= f.label :external_link, "外部リンク (URL)", class: "block text-sm font-medium text-gray-700" %>
      <%= f.url_field :external_link, class: "mt-1 block w-full rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
    </div>
  </div>

  <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
    <div class="flex items-center gap-4 mb-4">
      <div class="flex items-center h-5">
        <%= f.check_box :is_published, class: "focus:ring-black h-4 w-4 text-black border-gray-300 rounded" %>
      </div>
      <div class="ml-3 text-sm">
        <%= f.label :is_published, "公開する", class: "font-medium text-gray-700" %>
        <p class="text-gray-500">チェックを入れるとサイト上に公開されます。</p>
      </div>
    </div>

    <div>
      <%= f.label :published_at, "公開日時", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= f.datetime_field :published_at, class: "rounded-md !border-black !border-2 shadow-sm focus:border-black focus:ring-black", style: "border-color: #000 !important; border-width: 2px !important;" %>
    </div>
  </div>

  <div class="flex items-center justify-end gap-4 pt-4 border-t">
    <%= link_to "キャンセル", admin_works_path, class: "px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" %>
    <%= f.submit "保存する", class: "px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black cursor-pointer" %>
  </div>
<% end %>
